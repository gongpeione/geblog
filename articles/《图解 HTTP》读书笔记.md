# 《图解 HTTP》读书笔记

前段时间看到图灵在搞图解系列的活动，顺手就把图解系列三本书（HTTP，TCP/IP，网络硬件）入手了。一直没有完整的把图解 HTTP 刷一遍，实体书到手了准备没事翻一翻把这本书看完。

## HTTP 是啥

HTTP 是 HyperText Transfer Protocol 的缩写，约定俗成的翻译为超文本传输协议，但译者说更严谨的译名应该为“超文本转移协议 ”，有兴趣的同学可以去看图灵社区里的讨论，链接为：[关于HTTP中文翻译的讨论](http://www.ituring.com.cn/article/1817)

HTTP 是包括在 TCP/IP 协议族里的一个子集。TCP/IP 是互联网相关各类协议族的总称。下面对 TCP/IP 进行简单的介绍。

### TCP/IP

TCP/IP 分为：应用层，传输层，网络层和数据链路层。

- 应用层 Application layer：通用的应用服务，例如 FTP，DNS等，HTTP 也包含在这里面
- 传输层 Transport layer：TCP 和 UDP
- 网络层 Internet layer：处理网络上流动的数据包，数据包是网络传输最小数据单位。网络层规定了通过怎样的路径到达对方计算机，并把数据包传送给对方
- 链路层 Network access layer：网络硬件部分

> ![](https://ww2.sinaimg.cn/large/006tNc79gy1fdsbxobhrej30jg0f5jsk.jpg)

> TCP/IP 通信传输流

简单来说就是，应用层提供具体内容，后面的三层在内容的外部一层层包装上信息，送到下一层，最后把打上一层层信息的数据包传送给接收方，接收方再一层层的解包得到具体内容。

这种包装的做法叫做封装（encapsulate）。

### IP，TCP 和 DNS

这三个协议是和 HTTP 密不可分的。

#### IP 协议

即 Internet Protocol，它的作用是把封装好的数据包传送给对方。为了保证数据包能传送到对方那里，IP 地址和 MAC 地址是两个重要的条件。IP 地址是对方被分配到的地址，MAC 地址则是硬件地址。

通常来说网络中的两个设备很少在同一局域网内，那么两者通信就需要进行中转。这时就需要 ARP 协议（Address Resolution Protocol）来通过通信方的 IP 地址来反查对应的 MAC 地址。

那么你可能要问了，我已经知道对方的 IP 地址了，直接传过去不就好了么，为什么还要反查 MAC 地址？但是实际上，以太网中数据传输所依赖的是 MAC 地址而非 IP 地址，所以我们需要通过 ARP 来通过 IP 地址反查出 MAC 地址，才能顺利的把数据传输给对方。

#### TCP 协议

和 UDP 不同，TCP 协议是一个确保可靠性的协议，意思是指 TCP 协议可以把数据准确可靠的传送给对方。

为了确保数据能够到达对方，TCP 协议采用了三次握手策略（three-way handshaking）。

大致的过程就是：

1. 发送方 -> 接收方  哟我要发东西给你了你在咩
2. 发送方 <- 接收方  好哒我收到你的消息了
3. 发送方 -> 接收方  好的嘞我传数据了 xxxx

那么为什么是三次握手而不是两次四次五次呢？在这里转一个知乎上看到的段子：

```
三次握手：

1. “喂，你听得到吗？”
2. “我听得到呀，你听得到我吗？”
3. “我能听到你，今天balabala……”

两次握手：

1. “喂，你听得到吗？”
2. “我听得到呀”
3. “喂喂，你听得到吗？”
4. “草，我听得到呀！！！！”
5. “你TM能不能听到我讲话啊！！喂！”
6. “……”

四次握手：

1. “喂，你听得到吗？”
2. “我听得到呀，你听得到我吗？”
3. “我能听到你，你能听到我吗？”
4. “……不想跟傻逼说话”

```

[TCP 为什么是三次握手，为什么不是两次或四次？](https://www.zhihu.com/question/24853633/answer/114872771)

#### DNS 服务

DNS 服务提供域名到 IP 地址的服务。

#### 小结

一个完整的 HTTP 请求大致如下：

1. 客户端：我想访问 https://geeku.net，DNS 请告诉我他的 IP地址猴不猴 【IP 地址 GET】
2. HTTP 生成请求报文
3. TCP 协议将第二步的报文分割成报文段
4. IP 协议通过路由器一步步的中转传送
5. TCP 协议吧接收到的报文段拼回去
6. HTTP 对请求内容处理
7. 接收端：哟我收到了，我马上把你想要的通过同样的步骤传送给你

### URL 和 URI

URL(Uniform Resource Locator) 就是我们熟悉的网页地址了~ 用来表示资源的地点

URI(Uniform Resource Identifier) 则是统一资源标识符，是用字符串来标识某一个互联网资源。

由此可见，URL 是 URI 的子集

#### URI 的格式

`protocol://user:pass@domainNameOrIP:port/path/to/res/resouce.file?query=content#anchor`

## HTTP 的历史

历史是什么可以吃么？略过

